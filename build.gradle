apply plugin: 'base'

allprojects {
  apply from: "${rootProject.rootDir}/versions.gradle"
  version = "0.10.0"
  
  task vmap << { task ->
    println "\nDependencies for ${version} in ${task.project.name}:"
    versionMap.keySet().sort().each { k ->
      print k
      Integer spaces = 15 - k.size()
      Integer idx = 0
      while(idx < spaces) {
	print " "
	idx++;
      }
      println versionMap[k]
    }
    println ""
  }
  vmap.description = "Displays versions of all dependencies"



  task seesrc << { task ->
    println "\nSource sets for ${version} in ${task.project.name}:"
    task.project.runtimeClasspath.getFiles().each {
      println it
    }
  }
}

subprojects {
  apply plugin: "groovy"
  configurations.compile.transitive = true
  
  repositories {
    mavenCentral()
    maven {
      url "http://beta.hpcc.uh.edu/nexus/content/groups/public"
    }
  }
  dependencies {
    compile group: 'org.codehaus.groovy', name: 'groovy-all', version: versionMap['groovy']

    //compile group: 'edu.harvard.chs', name: 'cite', version: versionMap['cite']
    compile group: 'commons-io', name: 'commons-io', version: versionMap['commonsio']


    
    testCompile "junit:junit:${versionMap['junit']}"
    
  }

  // Only appropirate if we run fuseki in the bg -- othewise, blocks.
 // test.dependsOn ":fuseki:runFuseki"
  
  task initProject(description: 'Initializes project directories') << { task ->
    task.project.sourceSets*.groovy.srcDirs*.each { 
      println "Create directory $it"
      it.mkdirs() 
    }
  }
}


project(":webapp") {
  apply plugin: "war"
  apply plugin: "jetty" // replace this w gretty
  dependencies {
    compile project(":sparqlcts")
    // add these as they're implemented:
    /*
      compile project(":sparqlcc")
      compile project(":sparqlimg")
      compile project(":graph")
      compile project(":orca")
     */
  }
}

project(":sparqlcc") {
  dependencies {
    compile project(":common")
  }
}

project(":sparqlcts") {
  dependencies {
    compile project(":common")
  }
}

project(":sparqlimg") {
  dependencies {
    compile project(":common")
  }
}


// maybe use a group of tasks?
//test.dependsOn(":fuseki:runFuseki")
